{% extends 'base.html' %}

{% block content %}
<div class="container mt-4">
  <h2>Manchester United Players</h2>

  {% set groups = {
      'Goalkeepers': 'Goalkeeper',
      'Defenders': 'Defender',
      'Midfielders': 'Midfielder',
      'Forwards': 'Forward'
  } %}

  {% for group_name, pos in groups.items() %}
    {% set group_players = players | selectattr("position", "equalto", pos) | list %}
    {% if group_players|length > 0 %}
      <h3 class="mt-4">{{ group_name }}</h3>
      <div class="table-responsive">
        <table class="table table-striped table-hover mb-4">
          <thead>
            <tr>
              <th>Name</th>
              <th>Position</th>
              <th>Age</th>
              {% if group_name == "Goalkeepers" %}
                <th>Clean Sheets</th>
              {% else %}
                <th>Goals</th>
              {% endif %}
              <th>Assists</th>
              <th>Appearances</th>
              <th>Edit</th>
              <th>Delete</th>
            </tr>
          </thead>
          <tbody>
            {% for player in group_players %}
              <tr>
                <td>{{ player.name }}</td>
                <td>{{ player.position }}</td>
                <td>{{ player.age }}</td>
                {% if group_name == "Goalkeepers" %}
                  <td>{{ player.clean_sheets or 0 }}</td>
                {% else %}
                  <td>{{ player.goals or 0 }}</td>
                {% endif %}
                <td>{{ player.assists or 0 }}</td>
                <td>{{ player.appearances or 0 }}</td>
                <td>
                  <a href="{{ url_for('edit_player', player_id=player.id) }}"
                     class="btn btn-sm btn-primary">
                    Edit
                  </a>
                </td>
                <td>
                  <form action="{{ url_for('delete_player', player_id=player.id) }}"
                        method="post" class="d-inline">
                    <button type="submit"
                            class="btn btn-sm btn-danger"
                            onclick="return confirm('Delete {{ player.name }}?');">
                      Delete
                    </button>
                  </form>
                </td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    {% endif %}
  {% endfor %}
</div>
{% endblock %}
